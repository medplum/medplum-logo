<html>
  <head>
    <title>Slope vs Open Color</title>
    <style>
      * {
        font-family: monospace;
      }
      .swatch {
        width: 256px;
        height: 100px;
        border-radius: 16px;
        padding: 16px;
        line-height: 1.3;
      }
    </style>
  </head>
  <body>
    <div id="output"></div>
    <script>
      const colors = [
        ["Plum", 114, 31, 111, "Grape 9", 134, 46, 156],
        ["Plum", 114, 31, 111, "Grape 8", 156, 54, 181],
        ["Plum", 114, 31, 111, "Grape 7", 174, 62, 201],
        ["Lilac", 198, 125, 255, "Grape 3", 229, 153, 247],
        ["Light Lilac", 237, 222, 255, "Grape 1", 243, 217, 250],
        ["Lilac", 198, 125, 255, "Violet 3", 177, 151, 252],
        ["Light Lilac", 237, 222, 255, "Violet 1", 229, 219, 255],
        ["Blueberry", 158, 169, 253, "Indigo 3", 145, 167, 252],
        ["Light Blue", 217, 221, 255, "Indigo 1", 219, 228, 255],
        ["Apricot", 255, 233, 153, "Yellow 3", 255, 224, 102],
        ["Lemon", 255, 250, 232, "Yellow 1", 255, 243, 191],
        ["Honey", 255, 190, 103, "Orange 3", 255, 192, 120],
        ["Light Gray", 242, 242, 242, "Gray 1", 241, 243, 245],
        ["Med Gray", 159, 159, 159, "Gray 5", 173, 181, 189],
        ["Dark Gray", 54, 54, 54, "Gray 8", 52, 58, 64],
        ["Black", 24, 24, 24, "Gray 9", 33, 37, 41],
      ];

      const rgbToHex = (r, g, b) => {
        const toHex = (c) => {
          const hex = c.toString(16).toUpperCase();
          return hex.length === 1 ? "0" + hex : hex;
        };
        return "#" + toHex(r) + toHex(g) + toHex(b);
      };

      function rgb2hsv(r, g, b) {
        const rabs = r / 255;
        const gabs = g / 255;
        const babs = b / 255;
        let rr, gg, bb, h, s, v;
        v = Math.max(rabs, gabs, babs);
        const diff = v - Math.min(rabs, gabs, babs);
        const diffc = (c) => (v - c) / 6 / diff + 1 / 2;
        if (diff == 0) {
          h = s = 0;
        } else {
          s = diff / v;
          rr = diffc(rabs);
          gg = diffc(gabs);
          bb = diffc(babs);

          if (rabs === v) {
            h = bb - gg;
          } else if (gabs === v) {
            h = 1 / 3 + rr - bb;
          } else if (babs === v) {
            h = 2 / 3 + gg - rr;
          }
          if (h < 0) {
            h += 1;
          } else if (h > 1) {
            h -= 1;
          }
        }
        return [Math.round(h * 360), Math.round(s * 100), Math.round(v * 100)];
      }

      /**
       * Converts an sRGB color (0-255) to its relative luminance.
       * @param {object} rgb - An object containing r, g, and b values (0-255).
       * @returns {number} The relative luminance value (0-1).
       */
      function rgbToLuminance(r, g, b) {
        // Normalize RGB to sRGB
        const rsRGB = r / 255;
        const gsRGB = g / 255;
        const bsRGB = b / 255;

        // Convert sRGB to linear RGB
        const R =
          rsRGB <= 0.04045
            ? rsRGB / 12.92
            : Math.pow((rsRGB + 0.055) / 1.055, 2.4);
        const G =
          gsRGB <= 0.04045
            ? gsRGB / 12.92
            : Math.pow((gsRGB + 0.055) / 1.055, 2.4);
        const B =
          bsRGB <= 0.04045
            ? bsRGB / 12.92
            : Math.pow((bsRGB + 0.055) / 1.055, 2.4);

        // Calculate relative luminance
        const luminance = 0.2126 * R + 0.7152 * G + 0.0722 * B;
        return luminance;
      }

      const html = [];
      html.push(`<table>
        <thead>
          <tr>
            <th>Slope</th>
            <th>Open Color</th>
          </tr>
        </thead>
        <tbody>`);
      const markdown = [];
      for (const row of colors) {
        const [slopeName, r1, g1, b1, openColorName, r2, g2, b2] = row;
        const [h1, s1, v1] = rgb2hsv(r1, g1, b1);
        const [h2, s2, v2] = rgb2hsv(r2, g2, b2);
        const hex1 = rgbToHex(r1, g1, b1);
        const hex2 = rgbToHex(r2, g2, b2);
        const luminance = rgbToLuminance(r1, g1, b1);
        const textColor = luminance < 0.5 ? "white" : "black";
        html.push(`<tr>
          <td>
            <div class="swatch" style="background: ${hex1}; color: ${textColor}">
              <strong>${slopeName}</strong><br />HEX ${hex1}<br />RGB ${r1}, ${g1}, ${b1}<br />HSV ${h1}, ${s1}, ${v1}
            </div>
          </td>
          <td>
            <div class="swatch" style="background: ${hex2}; color: ${textColor}">
              <strong>${openColorName}</strong><br />HEX ${hex2}<br />RGB ${r2}, ${g2}, ${b2}<br />HSV ${h2}, ${s2}, ${v2}
            </div>
          </td>
        </tr>`);
        markdown.push(
          `| ${openColorName} | ${hex2} | ${r2} | ${g2} | ${b2} | ${h2} | ${s2} | ${v2} |`
        );
      }
      html.push(`</tbody></table>`);
      document.getElementById("output").innerHTML = html.join("");
      console.log(markdown.join("\n"));
    </script>
  </body>
</html>
