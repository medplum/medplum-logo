<html>
  <head>
    <title>Color</title>
  </head>
  <body>
    <h1>Color</h1>
    <div id="output"></div>
    <script>
      // gray
      // Name	R	G	B	L	H	S	V
      const gray = [
        [248, 249, 250, 210, 0.01, 0.98],
        [241, 243, 245, 210, 0.02, 0.96],
        [233, 236, 239, 210, 0.03, 0.94],
        [222, 226, 230, 210, 0.03, 0.9],
        [206, 212, 218, 210, 0.06, 0.85],
        [173, 181, 189, 210, 0.08, 0.74],
        [134, 142, 150, 210, 0.11, 0.59],
        [73, 80, 87, 210, 0.16, 0.34],
        [52, 58, 64, 210, 0.19, 0.25],
        [33, 37, 41, 210, 0.2, 0.16],
      ];
      // red
      // Name	R	G	B	L	H	S	V
      const red = [
        [255, 245, 245, 0, 0.04, 1.0],
        [255, 227, 227, 0, 0.11, 1.0],
        [255, 201, 201, 0, 0.21, 1.0],
        [255, 168, 168, 0, 0.34, 1.0],
        [255, 135, 135, 0, 0.47, 1.0],
        [255, 107, 107, 0, 0.58, 1.0],
        [250, 82, 82, 0, 0.67, 0.98],
        [240, 62, 62, 0, 0.74, 0.94],
        [224, 49, 49, 0, 0.78, 0.88],
        [201, 42, 42, 0, 0.79, 0.79],
      ];
      // pink
      // Name	R	G	B	L	H	S	V
      const pink = [
        [255, 240, 246, 336, 0.06, 1.0],
        [255, 222, 235, 336, 0.13, 1.0],
        [252, 194, 215, 338, 0.23, 0.99],
        [250, 162, 193, 339, 0.35, 0.98],
        [247, 131, 172, 339, 0.47, 0.97],
        [240, 101, 149, 339, 0.58, 0.94],
        [230, 73, 128, 339, 0.68, 0.9],
        [214, 51, 108, 339, 0.76, 0.84],
        [194, 37, 92, 339, 0.81, 0.76],
        [166, 30, 77, 339, 0.82, 0.65],
      ];
      // grape
      // Name	R	G	B	L	H	S	V
      const grape = [
        [248, 240, 252, 280, 0.05, 0.99],
        [243, 217, 250, 287, 0.13, 0.98],
        [238, 190, 250, 288, 0.24, 0.98],
        [229, 153, 247, 289, 0.38, 0.97],
        [218, 119, 242, 288, 0.51, 0.95],
        [204, 93, 232, 288, 0.6, 0.91],
        [190, 75, 219, 288, 0.66, 0.86],
        [174, 62, 201, 288, 0.69, 0.79],
        [156, 54, 181, 288, 0.7, 0.71],
        [134, 46, 156, 288, 0.71, 0.61],
      ];
      // violet
      // Name	R	G	B	L	H	S	V
      const violet = [
        [243, 240, 255, 252, 0.06, 1.0],
        [229, 219, 255, 257, 0.14, 1.0],
        [208, 191, 255, 256, 0.25, 1.0],
        [177, 151, 252, 255, 0.4, 0.99],
        [151, 117, 250, 255, 0.53, 0.98],
        [132, 94, 247, 255, 0.62, 0.97],
        [121, 80, 242, 255, 0.67, 0.95],
        [112, 72, 232, 255, 0.69, 0.91],
        [103, 65, 217, 255, 0.7, 0.85],
        [95, 61, 196, 255, 0.69, 0.77],
      ];
      // indigo
      // Name	R	G	B	L	H	S	V
      const indigo = [
        [237, 242, 255, 223, 0.07, 1.0],
        [219, 228, 255, 225, 0.14, 1.0],
        [186, 200, 255, 228, 0.27, 1.0],
        [145, 167, 255, 228, 0.43, 1.0],
        [116, 143, 252, 228, 0.54, 0.99],
        [92, 124, 250, 228, 0.63, 0.98],
        [76, 110, 245, 228, 0.69, 0.96],
        [66, 99, 235, 228, 0.72, 0.92],
        [59, 91, 219, 228, 0.73, 0.86],
        [54, 79, 199, 230, 0.73, 0.78],
      ];
      // blue
      // Name	R	G	B	L	H	S	V
      const blue = [
        [231, 245, 255, 205, 0.09, 1.0],
        [208, 235, 255, 206, 0.18, 1.0],
        [165, 216, 255, 206, 0.35, 1.0],
        [116, 192, 252, 206, 0.54, 0.99],
        [77, 171, 247, 207, 0.69, 0.97],
        [51, 154, 240, 207, 0.79, 0.94],
        [34, 139, 230, 208, 0.85, 0.9],
        [28, 126, 214, 208, 0.87, 0.84],
        [25, 113, 194, 209, 0.87, 0.76],
        [24, 100, 171, 209, 0.86, 0.67],
      ];
      // cyan
      // Name	R	G	B	L	H	S	V
      const cyan = [
        [227, 250, 252, 185, 0.1, 0.99],
        [197, 246, 250, 185, 0.21, 0.98],
        [153, 233, 242, 186, 0.37, 0.95],
        [102, 217, 232, 187, 0.56, 0.91],
        [59, 201, 219, 187, 0.73, 0.86],
        [34, 184, 207, 188, 0.84, 0.81],
        [21, 170, 191, 187, 0.89, 0.75],
        [16, 152, 173, 188, 0.91, 0.68],
        [12, 133, 153, 189, 0.92, 0.6],
        [11, 114, 133, 189, 0.92, 0.52],
      ];
      // teal
      // Name	R	G	B	L	H	S	V
      const teal = [
        [230, 252, 245, 161, 0.09, 0.99],
        [195, 250, 232, 160, 0.22, 0.98],
        [150, 242, 215, 162, 0.38, 0.95],
        [99, 230, 190, 162, 0.57, 0.9],
        [56, 217, 169, 162, 0.74, 0.85],
        [32, 201, 151, 162, 0.84, 0.79],
        [18, 184, 134, 162, 0.9, 0.72],
        [12, 166, 120, 162, 0.93, 0.65],
        [9, 146, 104, 162, 0.94, 0.57],
        [8, 127, 91, 162, 0.94, 0.5],
      ];
      // green
      // Name	R	G	B	L	H	S	V
      const green = [
        [235, 251, 238, 131, 0.06, 0.98],
        [211, 249, 216, 128, 0.15, 0.98],
        [178, 242, 187, 128, 0.26, 0.95],
        [140, 233, 154, 129, 0.4, 0.91],
        [105, 219, 124, 130, 0.52, 0.86],
        [81, 207, 102, 130, 0.61, 0.81],
        [64, 192, 87, 131, 0.67, 0.75],
        [55, 178, 77, 131, 0.69, 0.7],
        [47, 158, 68, 131, 0.7, 0.62],
        [43, 138, 62, 132, 0.69, 0.54],
      ];
      // lime
      // Name	R	G	B	L	H	S	V
      const lime = [
        [244, 252, 227, 79, 0.1, 0.99],
        [233, 250, 200, 80, 0.2, 0.98],
        [216, 245, 162, 81, 0.34, 0.96],
        [192, 235, 117, 82, 0.5, 0.92],
        [169, 227, 75, 83, 0.67, 0.89],
        [148, 216, 45, 84, 0.79, 0.85],
        [130, 201, 30, 85, 0.85, 0.79],
        [116, 184, 22, 85, 0.88, 0.72],
        [102, 168, 15, 86, 0.91, 0.66],
        [92, 148, 13, 85, 0.91, 0.58],
      ];
      // yellow
      // Name	R	G	B	L	H	S	V
      const yellow = [
        [255, 249, 219, 50, 0.14, 1.0],
        [255, 243, 191, 49, 0.25, 1.0],
        [255, 236, 153, 49, 0.4, 1.0],
        [255, 224, 102, 48, 0.6, 1.0],
        [255, 212, 59, 47, 0.77, 1.0],
        [252, 196, 25, 45, 0.9, 0.99],
        [250, 176, 5, 42, 0.98, 0.98],
        [245, 159, 0, 39, 1.0, 0.96],
        [240, 140, 0, 35, 1.0, 0.94],
        [230, 119, 0, 31, 1.0, 0.9],
      ];
      // orange
      // Name	R	G	B	L	H	S	V
      const orange = [
        [255, 244, 230, 34, 0.1, 1.0],
        [255, 232, 204, 33, 0.2, 1.0],
        [255, 216, 168, 33, 0.34, 1.0],
        [255, 192, 120, 32, 0.53, 1.0],
        [255, 169, 77, 31, 0.7, 1.0],
        [255, 146, 43, 29, 0.83, 1.0],
        [253, 126, 20, 27, 0.92, 0.99],
        [247, 103, 7, 24, 0.97, 0.97],
        [232, 89, 12, 21, 0.95, 0.91],
        [217, 72, 15, 17, 0.93, 0.85],
      ];

      const colors = [
        gray,
        // red,
        // pink,
        grape,
        violet,
        indigo,
        // blue,
        // cyan,
        // teal,
        // green,
        // lime,
        yellow,
        orange,
      ];

      /**
       * Converts HSV color values to RGB.
       * @param {number} h Hue (0-360)
       * @param {number} s Saturation (0-1)
       * @param {number} v Value (0-1)
       * @return {string} RGB color in hexadecimal format (e.g., "#FF0000")
       * @customfunction
       */
      function HSVtoRGB(h, s, v) {
        let r, g, b;
        const i = Math.floor(h / 60);
        const f = h / 60 - i;
        const p = v * (1 - s);
        const q = v * (1 - f * s);
        const t = v * (1 - (1 - f) * s);

        switch (i % 6) {
          case 0:
            r = v;
            g = t;
            b = p;
            break;
          case 1:
            r = q;
            g = v;
            b = p;
            break;
          case 2:
            r = p;
            g = v;
            b = t;
            break;
          case 3:
            r = p;
            g = q;
            b = v;
            break;
          case 4:
            r = t;
            g = p;
            b = v;
            break;
          case 5:
            r = v;
            g = p;
            b = q;
            break;
        }

        // const toHex = (c) => {
        //   const hex = Math.round(c * 255).toString(16);
        //   return hex.length === 1 ? "0" + hex : hex;
        // };

        // return "#" + toHex(r) + toHex(g) + toHex(b);
        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
      }

      const rgbToHex = (r, g, b) => {
        const toHex = (c) => {
          const hex = c.toString(16);
          return hex.length === 1 ? "0" + hex : hex;
        };
        return "#" + toHex(r) + toHex(g) + toHex(b);
      };

      /**
       * Converts an sRGB color (0-255) to its relative luminance.
       * @param {object} rgb - An object containing r, g, and b values (0-255).
       * @returns {number} The relative luminance value (0-1).
       */
      function rgbToLuminance(r, g, b) {
        // Normalize RGB to sRGB
        const rsRGB = r / 255;
        const gsRGB = g / 255;
        const bsRGB = b / 255;

        // Convert sRGB to linear RGB
        const R =
          rsRGB <= 0.04045
            ? rsRGB / 12.92
            : Math.pow((rsRGB + 0.055) / 1.055, 2.4);
        const G =
          gsRGB <= 0.04045
            ? gsRGB / 12.92
            : Math.pow((gsRGB + 0.055) / 1.055, 2.4);
        const B =
          bsRGB <= 0.04045
            ? bsRGB / 12.92
            : Math.pow((bsRGB + 0.055) / 1.055, 2.4);

        // Calculate relative luminance
        const luminance = 0.2126 * R + 0.7152 * G + 0.0722 * B;
        return luminance;
      }

      /**
       * Calculates the contrast ratio between two luminance values.
       * @param {number} l1 - The relative luminance of the first color.
       * @param {number} l2 - The relative luminance of the second color.
       * @returns {number} The contrast ratio (e.g., 4.5).
       */
      function luminanceToContrast(l1, l2) {
        const L1 = Math.max(l1, l2);
        const L2 = Math.min(l1, l2);

        const contrast = (L1 + 0.05) / (L2 + 0.05);
        return contrast;
      }

      /**
       * Formats a contrast value into a string ratio.
       * @param {number} contrast - The contrast value.
       * @returns {string} The contrast ratio formatted as a string (e.g., "4.5:1").
       */
      function contrastToRatioString(contrast) {
        // Round to two decimal places for readability
        return `${contrast.toFixed(2)}:1`;
      }

      const html = ["<table>"];

      for (let y = 0; y < colors.length; y++) {
        html.push("<tr>");
        for (let x = 0; x < colors.length; x++) {
          const bgIndex = 2;
          const fgIndex = 9;
          const bg = rgbToHex(
            colors[x][bgIndex][0],
            colors[x][bgIndex][1],
            colors[x][bgIndex][2]
          );
          const fg = rgbToHex(
            colors[y][fgIndex][0],
            colors[y][fgIndex][1],
            colors[y][fgIndex][2]
          );
          const l1 = rgbToLuminance(
            colors[x][bgIndex][0],
            colors[x][bgIndex][1],
            colors[x][bgIndex][2]
          );
          const l2 = rgbToLuminance(
            colors[y][fgIndex][0],
            colors[y][fgIndex][1],
            colors[y][fgIndex][2]
          );
          const contrast = luminanceToContrast(l1, l2);
          const ratio = contrastToRatioString(contrast);
          html.push("<td>");
          html.push(`<svg
   viewBox="0 0 540 540"
   version="1.1"
   id="svg1"
   sodipodi:docname="medplum-symbol-plum-on-white.svg"
   width="540"
   height="540"
   inkscape:version="1.4.2 (ebf0e940, 2025-05-08)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs1" />
  <rect
     style="fill:${bg}"
     id="rect1"
     width="540"
     height="540"
     x="0"
     y="0" />
  <path
     d="m 264,236 c -3,-15 -15,-24 -23,-28 l 5,-10 c 8,2 14,8 20,14 0,-12 1,-16 5,-21 8,-9 13,-9 41,-9 0,7 1,18 -3,24 -7,9 -16,7 -41,8 5,8 7,14 8,22 36,-24 74,-7 74,39 0,42 -40,83 -80,83 -40,0 -80,-41 -80,-83 0,-46 38,-63 74,-39 z m -3,43 h -16 c -4,0 -7,3 -7,7 v 4 c 0,4 3,7 7,7 h 16 v 16 c 0,4 3,7 7,7 h 4 c 4,0 7,-3 7,-7 v -16 h 16 c 4,0 7,-3 7,-7 v -4 c 0,-4 -3,-7 -7,-7 h -16 v -16 c 0,-4 -3,-7 -7,-7 h -4 c -4,0 -7,3 -7,7 z"
     fill="${fg}"
     id="path1" />
</svg>`);
          html.push("<br>");
          html.push(`Background: ${bg}`);
          html.push("<br>");
          html.push(`Foreground: ${fg}`);
          html.push("<br>");
          html.push(`Ratio: ${ratio}`);
          html.push("</td>");
        }
        html.push("</tr>");
      }

      html.push("</table>");

      document.getElementById("output").innerHTML = html.join("");
    </script>
  </body>
</html>
